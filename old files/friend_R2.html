<html>
<head>
 <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- css -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
	<link href="color/default.css" rel="stylesheet" media="screen">
	<script src="js/modernizr.custom.js"></script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="jquery-2.1.4.min.js"></script>
<style type="text/css">
	*{}
	body{background-color: #1A1A1A;color:white; }
	
#submit{color:black;}
</style>
<script>

	var total;
	var array =[];
	var username = [];
	var profilephoto=[];
	
	var friendship = "false";

	$(document).ready(function()
	{	

		request = $.ajax({
					url: "http://localhost:3000/findFriend",
					type: "post",
					data: {session:localStorage.getItem("session")}
					});
		request.done(function (response, textStatus, jqXHR)
		{
			//console.log(response);
			populate(response);
			dynamic();
		});

		request.fail(function (jqXHR, textStatus, errorThrown)
		{
				console.error("The following error occurred: "+textStatus, errorThrown);
		});
		});	

/*$(function(){
    $("FriendButton").click(function() {
        alert($(this).attr("value"));
    });
});*/
	
function populate(val)
{
	var data=JSON.parse(val);
	
	for(i = 0; i < data.length; i++) {
	console.log(data[i].FName + "," + data[i].Email);
	array[i] = data[i].FName + "," + data[i].Email;
	profilephoto[i] = data[i].Photo;
	username[i] = data[i].Email;
	}
	
	total = data.length;
	console.log(total);
	//document.getElementById("email").value=data[1].FName;
}

function compareFriend(val) {
	
	console.log("value passed in: " + val);
	request=$.ajax({
				url:"http://localhost:3000/compare",
				type:"post",
				data:{friendEmail: val, session:localStorage.getItem("session")}
				});
				
	request.done(function(response,textstatus,jqXHR)
	{
		//console.log("response " +response);
		if(response === "Found") friendship = "true";
		else friendship = "false";
		
		console.log("friendship: " + friendship);
	})
				
	request.fail(function (jqXHR, textStatus, errorThrown)
	{
		console.error("The following error occurred: "+textStatus, errorThrown);
		friendship = "false";

	});		
}

function sendRequest(val) {
	var splitVal;
	var friendEmail;
	splitVal = val.split(',');
	console.log(splitVal[1]);
	
	request=$.ajax({
				url:"http://localhost:3000/sendRequest",
				type:"post",
				data:{friendEmail:splitVal[1], session:localStorage.getItem("session")}
				});
				request.done(function(response,textstatus,jqXHR)
				{
					//console.log(response);
				})
				request.fail(function (jqXHR, textStatus, errorThrown)
				{
					console.error("The following error occurred: "+textStatus, errorThrown);
				});
}

</script>

<script>

function dynamic(){

	table = document.createElement('table');
	var but = [];
	var isFriend;
	
	console.log("total: " + total);
	for( var i = 0;i < total;i++){
		 tr = document.createElement('tr');   

		for (var j = 0; j < 3; j++){
	
			td1 = document.createElement('td');
			//var input = document.createElement('input');
			if(j==0) {
			//document.getElementById("photoShow").src="file:///C:/Users/Xiao/WebstormProjects/backend/"+username[i]+profilephoto[i];
				var img = document.createElement('img');
				
				//console.log(profilephoto[i]);
				if(profilephoto[i] == null) img.src="file:///C:/Users/Xiao/WebstormProjects/backend/default_user.jpg";
				else img.src="file:///C:/Users/Xiao/WebstormProjects/backend/"+username[i]+profilephoto[i];
				td1.appendChild(img);
			}
			
			else if(j==1)
			{
				td1.innerHTML=array[i];
				//alert(array[i] + "inside dynamic");
			}
			else if(j==2)
			{
				console.log(i);
				var val = username[i];
				console.log("username "+val);
				compareFriend(val);
				isFriend = friendship;
				
				console.log("isFrined "+ friendship);
				
				but[i] = document.createElement('button');
				
				if(isFriend === "false") 
				{
					but[i].innerHTML="add friend";
					but[i].addEventListener('click',makeHandler(array[i]),false);
					//alert(i);
					but[i].className = "FriendButton";
					td1.appendChild(but[i]);
				} else 
				{
					but[i].disabled;
					//.disabled;
				}				
				
			}
	//td1.appendChild(input);
			tr.appendChild(td1);
			table.appendChild(tr);
		}
	}

	//document.getElementById("div1").innerHTML = "";
	document.getElementById("div1").appendChild(table);
	function makeHandler(val) {
		return function() {
		var youremail = val;
		alert("Friend request has sent to " + youremail);
		sendRequest(youremail);
		};
	}
    
	//for (var k = 0; k < total; k++) {
	//	but[k].onclick = makeHandler(k);
    // }
}

</script>
</head>
<body>
<div class="menu-area">
			<div id="dl-menu" class="dl-menuwrapper">
						<button class="dl-trigger">Open Menu</button>
						<ul class="dl-menu">
							<li>
								<a href="#intro">Home</a>
							</li>
							<li><a href="#about">About</a></li>
							<li><a href="#services">Services</a></li>
							<li><a href="#works">Works</a></li>
							<li><a href="#contact">Contact</a></li>
							<li><a href="prof.html">Profile</a></li>
							<li>
								<a href="#">Friends</a>
								<ul class="dl-submenu">
									<li><a href="friend.html">Find Friends</a></li>
									<li><a href="managefriend.html">Manage Friends</a></li>
								</ul>
							</li>
						</ul>
					</div><!-- /dl-menuwrapper -->
	</div>	
<input placeholder="Search Friends"></input><button id="submit" color="black">Find Bikers</button>
<!-- <button id="submit" onclick="dynamic()">Find Friends</button> -->
<div id="div1">

Send a friend request!

</div>
 <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.smooth-scroll.min.js"></script>
	<script src="js/jquery.dlmenu.js"></script>
	<script src="js/wow.min.js"></script>
	<script src="js/custom.js"></script>
</body>

</html>